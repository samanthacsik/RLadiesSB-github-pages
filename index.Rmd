---
title: "A *very* important report on global UFO sightings and abductions"
subtitle: "*(But mainly a lesson on using R Markdown and GitHub Pages to share your work)*"
author: "*Compiled on `r date()` by Sam Csik & Juliette Verstaen`*"
date: "March 2020"
output:
  html_document:
    code_folding: hide
    toc: true
    toc_float: true
    theme: spacelab
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## About and Credits

These materials were developed by Sam Csik & Juliette Verstaen using UFO Sighting Data from the National UFO Reporting  Center (NUFORC). Data can be downloaded from [kaggle](https://www.kaggle.com/NUFORC/ufo-sightings). Source code can be found on [GitHub](https://github.com/samanthacsik/RLadiesSB-github-pages).

In this example report, we demonstrate how to use a variety of different `HTML widgets` that allow for interactive web visualizations, as well as how to leverage [R Markdown](https://rmarkdown.rstudio.com/lesson-1.html) and [GitHub Pages](https://pages.github.com/) for building web pages to display reports (or whatever else you might dream of creating with RMarkdown). 

Expand hidden `Code` chunks to see how we've created the following tables, maps, and plots. Also, be on the lookout for <span style="color: green;">**TIP**</span>s and <span style="color: blue;">**RESOURCE**</span>s throughout for pointers and links to resources!

And finally, before we get started, the [R Markdown Cookbook](https://bookdown.org/yihui/rmarkdown-cookbook/) by *Yihui Xie, Christophe Dervieux, & Emily Riederer* and [R Markdown: The Definitive Guide](https://bookdown.org/yihui/rmarkdown/) by *Yihui Xie, J. J. Allaire, & Garrett Grolemund* contain **tons** of incredible information and answers to nearly all of the RMarkdown-related questions we have encountered. We recommend coming back to these to learn more about all-things RMarkdown.

## Setting up your RMarkdown file

* [customizing the YAML](linked_pages/yaml.html)
* [a note on code chunks](linked_pages/code_chunks.html)
* [in-line formatting](linked_pages/inline_formatting.html)
* [creating tabs](linked_pages/creating_tabs.html) 
* [publishing your .Rmd as a GitHub Page](linked_pages/github_pages.html)

```{r, warning = FALSE, message = FALSE, results = 'hide', echo = FALSE}
###########################
# load packages
###########################

## for cleaning and wrangling
library(tidyverse)
library(janitor)
library(lubridate) 

## for map making and general spatial work
library(leaflet)
library(mapview)
library(sf)

## for working with time series data
library(dygraphs)
library(xts)

## for making tables
library(DT)
library(gt)

## for palette making
library(RColorBrewer)
library(colorspace)
library(scales)

###########################
# load data
###########################

UFO_data <- read_csv(here::here("data", "UFO_complete.csv"))
```

## Alien Encounters {.tabset}

### Timeseries
```{r}
source(here::here("code/palettes.R"))
colors <- alien_palette("galaxy_quest", 8, "discrete")

# create time series object

UFO_dygraph <- UFO_data %>% 
  clean_names() %>% 
  select(-date_posted) %>% 
  separate(datetime, c("month", "second", "third"), sep = "/") %>% 
  separate(third, c("year", "time"), sep = " ") %>% 
  group_by(year) %>%
  count() %>% 
  rename(number_instances = n) %>% 
  filter(!is.na(year)) %>% 
  mutate(date_seen = paste("01/01/", year, sep = "")) %>% 
  mutate(date_seen = as.character(date_seen),
         date_seen = as.Date(date_seen, format = "%m/%d/%Y"))
         
ufo_timeseries <- xts(x = UFO_dygraph$number_instances,
                              order.by = UFO_dygraph$date_seen)

# Finally the plot
dy_plot <- dygraph(ufo_timeseries, main = "Aliens from Earth")%>%
  dyRangeSelector() %>% 
  dyOptions(labelsUTC = TRUE, fillGraph=TRUE, fillAlpha=0.1, drawGrid = FALSE, colors= colors[1]) %>%
  dyCrosshair(direction = "vertical") %>% 
  dyHighlight(highlightCircleSize = 5, highlightSeriesBackgroundAlpha = 0.2, hideOnMouseOut = FALSE) %>% 
  dyRoller(rollPeriod = 1) %>% 
  dyAxis("y", label = "Number of sightings, abductions, etc")

dy_plot

```

### other tab here

### maybe another tab here

## Alien Abductions {.tabset}

### All accounts of abuctions 

```{r, warning = FALSE, message = FALSE}
##############################
# clean up UFO_data to display in an interactive table
##############################

Table1_abduction_data <- UFO_data %>% 
  clean_names() %>% 
  #mutate(as_datetime(datetime)) %>% 
  filter(str_detect(comments, "(?i)abduction")) %>% 
  select(datetime, date_posted, country, state, city, duration_seconds, shape, comments) %>% 
  arrange(datetime)

##############################
# generate an interactive table (using the `DT` package) 
##############################

Table1 <- datatable(Table1_abduction_data,
                    class = 'cell-border stripe',
                    colnames = c("Date/Time (of encounter)", "Date Reported", 
                                 "Country", "State", "City", "Duration of Encounter (sec)", 
                                 "Shape of UFO", "Comments"),
                    caption = htmltools::tags$caption(
                      style = 'caption-side: top; text-align: left;', 
                      htmltools::em('Table 1: Global accounts of alien abductions from 1910-2013.')),
                    filter = 'top', options = list(pageLength = 5, autoWidth = TRUE))

##############################
# display table in knitted doc
##############################

Table1
```
<span style="color: blue;">**RESOURCE:**</span> Explore [DT: An R interface to the DataTables library](https://rstudio.github.io/DT/) for more ways to customize your DT tables.

### Map of alien abductions

```{r}
##############################
# wrangle data (get latitude, longitude, comment information for all comments mentioning "abduction")
##############################

leaflet_abduction_data <- UFO_data %>% 
  filter(str_detect(comments, "(?i)abduction")) %>% 
  mutate(latitude = as.numeric(latitude), # leaflet requires lat/long to be numeric values
         longitude = as.numeric(longitude))

###########################
# make a custom icon 
###########################

UFO_icon <- makeIcon(iconUrl = "media/ufo.png", 
                     iconWidth = 35, iconHeight = 45)

###########################
# make interactive map (using the `leaflet` package)
###########################

abduction_map <- leaflet(leaflet_abduction_data) %>% 
  addProviderTiles(providers$CartoDB.Positron) %>% # add basemap and choose style
  addMarkers(lng = ~longitude, lat = ~latitude, icon = UFO_icon, popup = ~ comments) %>% # add UFO_icon as data points
  addMiniMap(tiles = providers$CartoDB.Positron, # add a mini map to show zoom coverage
             toggleDisplay = TRUE)

###########################
# display map in knitted doc
###########################

abduction_map
```

<span style="color: blue;">**RESOURCE:**</span> Explore [Leaflet for R](https://rstudio.github.io/leaflet/) for more ways to customize your Leaflet maps.

## Resources

* The [R Markdown Reference Guide](https://rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf) is a great cheat sheet for Markdown syntax and knitr chunk options
* For a list of awesome interactive **`htmlwidgets`** for R see [here](https://www.htmlwidgets.org/showcase_leaflet.html). Find even more options in the [htmlwidgets gallery](http://gallery.htmlwidgets.org/).
* [A Guide to GitHub Pages](https://www.thinkful.com/learn/a-guide-to-using-github-pages/). This is a cool choose-your-own-adventure-style resource if youâ€™re comfortable in the command line.



